// Generated by CoffeeScript 1.4.0
(function() {

  $(document).ready(function() {
    $(document).bind('keypress', function(e) {
      var changeClass, fontsize, tagName;
      if (event.shiftKey && event.which === 74) {
        fontsize = window.prompt("font-size?", "" + ($('.clicked').css('font-size')));
        if (fontsize != null) {
          $('.clicked').css('font-size', fontsize);
        }
      }
      if (event.shiftKey && event.which === 87) {
        changeClass = window.prompt("What class to wrap with");
        if (changeClass != null) {
          $('.clicked').wrap('<div class=' + "'" + changeClass + "'" + '/>');
        }
      }
      if (event.shiftKey && event.which === 84) {
        tagName = window.prompt("tagName?", "" + ($('.clicked').prop('tagName').toLowerCase()));
        if (tagName != null) {
          $('.clicked').replaceWith(function() {
            return $("<" + tagName + " />").append($('.clicked').contents());
          });
        }
      }
      if (event.shiftKey && event.which === 68) {
        return $('.clicked').draggable({
          grid: [50, 50],
          stop: function() {
            return $(this).draggable('disable');
          }
        });
      }
    });
    chrome.extension.onMessage.addListener(function(request, sender, sendResponse) {
      var changeClass, changeTag, color, element, font, fontSize, text;
      if (request.action === "loadBootstrap") {
        $("head").append("          <link href='//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css' rel='stylesheet'>        ");
        $('body').wrap('<div class="container" />');
      }
      if (request.action === "changeElement") {
        element = $('.clicked');
        changeClass = request.changeClass;
        if (changeClass === "navbar") {
          element.wrap('<div class="navbar" />');
          element.addClass('brand');
          element.wrap('<div class="navbar-inner" />');
          $(".navbar-inner").append('<ul class="nav pull-right sortable"></ul>');
        } else if (changeClass === "nav") {
          text = element.text();
          element.remove();
          $('ul.nav').append("<li><a href='#'>" + text + "</a></li>");
        } else if (changeClass === "addToHero") {
          $(".hero-unit").append(element);
        } else {
          element.wrap('<div class=' + '"' + changeClass + '"' + ' />');
        }
      }
      if (request.action === "changeTagName") {
        changeTag = request.changeTag;
        element = $('.clicked');
        element.replaceWith(function() {
          return $("<h2 />").append(element.contents());
        });
      }
      if (request.action === "changeFont") {
        font = request.font;
        element = $('.clicked');
        fontSize = request.fontSize;
        color = "#" + request.color;
        $("head").append("        <link href='http://fonts.googleapis.com/css?family=" + font + "' rel='stylesheet' type='text/css'>        ");
        font = font.split("+").join(" ");
        element.css;
        element.css('font-family', font);
        element.css('font-size', fontSize);
        return element.css('color', color);
      }
    });
    return $('body').on("click", "h1, h2, h3, p, a, li", function(e) {
      var x;
      e.preventDefault();
      x = $(this);
      $('.clicked').css('background', 'none');
      $('.clicked').removeClass('clicked');
      x.addClass('clicked');
      x.css('background', 'rgb(255, 251, 204)');
      return chrome.extension.sendMessage({
        "tagName": x.prop("tagName").toLowerCase(),
        "fontSize": x.css("font-size")
      });
    });
  });

}).call(this);
